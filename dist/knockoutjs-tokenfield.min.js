/*! knockoutjs-tokenfield - v1.0.2 - 25-07-2014 */
var tokenFieldUtils=function(){this.addTokenField=function(a){tokenBaseModel.fields[a.id]=new tokenFieldModel,ko.applyBindings(tokenBaseModel.fields[a.id],a)},this.processBindings=function(a){var b={};if(b.Remote=a().tokenFieldRemote,b.Method=a().tokenFieldMethod,b.Datatype=a().tokenFieldDatatype,b.Query=a().tokenFieldQuery,b.FieldKey=a().tokenFieldKey,b.FieldVal=a().tokenFieldValue,b.Delimiter=a().tokenFieldDelimiter,void 0===b.Remote)throw"Tokenfield remote server required.";return void 0===b.Method&&(b.Method="GET"),void 0===b.Datatype&&(b.Datatype="json"),void 0===b.Query&&(b.Query="q"),void 0===b.FieldKey&&(b.FieldKey="id"),void 0===b.FieldVal&&(b.FieldVal="value"),void 0===b.Delimiter&&(b.Delimiter=","),b}},tokenBaseModel={fields:[]},tokenFieldModel=function(){var a=this;this.items=ko.observableArray([]),this.addItem=function(b){a.items.push(new tokenItemModel(b))},this.removeItem=function(b){var c;null!=b.id?ko.utils.arrayForEach(this.items(),function(a){a.id===b.id&&ko.unwrap(a.value)==b.value&&(c=a)}):ko.utils.arrayForEach(this.items(),function(a){ko.unwrap(a.value)===b.value&&(c=a)}),a.items.remove(c)}},tokenItemModel=function(a){$.extend(this,a)};ko.observableArray.fn.refreshAll=function(a){var b=this();return this.valueWillMutate(),this.removeAll(),ko.utils.arrayPushAll(b,a),this.valueHasMutated(),this},ko.observable.fn.refreshAll=function(a,b,c){this.valueWillMutate();var d="";return ko.utils.arrayForEach(a,function(a){""!=d&&(d+=b),d+=void 0===a[c]?a.value:a[c]}),this(d),this.valueHasMutated(),this},ko.bindingHandlers.tokenField={init:function(a,b,c){var d=(new tokenFieldUtils).processBindings(c);ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).tokenfield("destroy")}),ko.utils.registerEventHandler(a,"tokenfield:createdtoken",function(b){0===b.attrs.value.indexOf("_")&&$(b.relatedTarget).addClass("tt-private"),tokenBaseModel.fields[a.id].addItem(b.attrs)}),ko.utils.registerEventHandler(a,"tokenfield:removedtoken",function(b){tokenBaseModel.fields[a.id].removeItem(b.attrs)}),$(a).tokenfield({delimiter:d.Delimiter,allowEditing:!1,createTokensOnBlur:!0,typeahead:[null,{name:a.id,displayKey:d.FieldVal,source:function(){var a;return function(b,c){a&&a.abort(),b=b.split(",").reverse()[0].trim(),req_data={},req_data[d.Query]=b,a=$.ajax({url:d.Remote,data:req_data,type:d.Method,dataType:d.Datatype,success:function(a){c(a)},error:function(){c([])}})}}()}]})},update:function(a,b,c){var d=b()||{},e=(new tokenFieldUtils).processBindings(c);d.refreshAll(ko.unwrap(tokenBaseModel.fields[a.id].items),e.Delimiter,e.FieldKey)}};