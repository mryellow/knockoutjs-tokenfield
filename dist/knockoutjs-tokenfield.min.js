/*! knockoutjs-tokenfield - v1.0.3 - 29-07-2014 */
define(["jquery","knockout"],function(a,b){b.tokenfield={},b.bindingHandlers.tokenField={init:function(c,d,e){var f=d()||{};if(b.tokenfield[c.id]={},b.tokenfield[c.id].handlerEnabled=!0,b.tokenfield[c.id].bindings={},b.tokenfield[c.id].bindings.Remote=e().tokenFieldRemote,b.tokenfield[c.id].bindings.Method=e().tokenFieldMethod,b.tokenfield[c.id].bindings.Datatype=e().tokenFieldDatatype,b.tokenfield[c.id].bindings.Query=e().tokenFieldQuery,b.tokenfield[c.id].bindings.KeyIndex=e().tokenFieldKeyIndex,b.tokenfield[c.id].bindings.KeyDisplay=e().tokenFieldKeyDisplay,b.tokenfield[c.id].bindings.Delimiter=e().tokenFieldDelimiter,void 0===b.tokenfield[c.id].bindings.Remote)throw"Tokenfield remote server required.";void 0===b.tokenfield[c.id].bindings.Method&&(b.tokenfield[c.id].bindings.Method="GET"),void 0===b.tokenfield[c.id].bindings.Datatype&&(b.tokenfield[c.id].bindings.Datatype="json"),void 0===b.tokenfield[c.id].bindings.Query&&(b.tokenfield[c.id].bindings.Query="q"),void 0===b.tokenfield[c.id].bindings.KeyIndex&&(b.tokenfield[c.id].bindings.KeyIndex="value"),void 0===b.tokenfield[c.id].bindings.KeyDisplay&&(b.tokenfield[c.id].bindings.KeyDisplay="label"),void 0===b.tokenfield[c.id].bindings.Delimiter&&(b.tokenfield[c.id].bindings.Delimiter=","),b.utils.domNodeDisposal.addDisposeCallback(c,function(){a(c).tokenfield("destroy")}),b.utils.registerEventHandler(c,"tokenfield:createdtoken",function(d){0===d.attrs[b.tokenfield[c.id].bindings.KeyDisplay].indexOf("_")&&a(d.relatedTarget).addClass("tt-private"),b.tokenfield[c.id].handlerEnabled===!0&&f.push(d.attrs)}),b.utils.registerEventHandler(c,"tokenfield:removedtoken",function(a){var c,d=f.peek();b.utils.arrayForEach(d,function(d){b.unwrap(d.id)===a.attrs.id?c=d:b.unwrap(d.label)===a.attrs.label&&b.unwrap(d.value)===a.attrs.value&&(c=d)}),f.remove(c)}),a(c).tokenfield({delimiter:b.tokenfield[c.id].bindings.Delimiter,allowEditing:!1,createTokensOnBlur:!0,typeahead:[null,{name:c.id,displayKey:b.tokenfield[c.id].bindings.KeyDisplay,source:function(){var d;return function(e,f){d&&d.abort(),e=e.split(",").reverse()[0].trim(),req_data={},req_data[b.tokenfield[c.id].bindings.Query]=e,d=a.ajax({url:b.tokenfield[c.id].bindings.Remote,data:req_data,type:b.tokenfield[c.id].bindings.Method,dataType:b.tokenfield[c.id].bindings.Datatype,success:function(a){f(a)},error:function(){f([])}})}}()}]})},update:function(c,d){var e=d()||{},f=b.unwrap(e.peek());b.tokenfield[c.id].handlerEnabled=!1,a(c).tokenfield("setTokens",f),b.tokenfield[c.id].handlerEnabled=!0}}});